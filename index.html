<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบทดสอบ Python พื้นฐาน</title>
    <!-- โหลด Tailwind CSS สำหรับการจัดสไตล์ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* กำหนดค่าเริ่มต้นสำหรับฟอนต์ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>

    <div id="quiz-container" class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="bg-white shadow-lg rounded-xl p-6 mb-8 border-t-4 border-indigo-500">
            <h1 class="text-3xl font-bold text-gray-800 text-center">แบบทดสอบ Python พื้นฐาน</h1>
            <p class="text-lg text-gray-500 text-center mt-2">ทดสอบความรู้พื้นฐาน Python ของคุณ - 20 ข้อ</p>
        </header>

        <!-- 1. หน้าจอสำหรับกรอกข้อมูลผู้เข้าสอบ (เริ่มต้น) -->
        <div id="form-screen" class="bg-white shadow-xl rounded-xl p-6 sm:p-8 transition-all duration-500">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">ข้อมูลผู้เข้าสอบ</h2>
            <form id="user-info-form" onsubmit="startQuiz(event)">
                <div class="mb-4">
                    <label for="user-name" class="block text-sm font-medium text-gray-700">ชื่อ-นามสกุล:</label>
                    <input type="text" id="user-name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="กรุณากรอกชื่อ-นามสกุล">
                </div>
                <div class="mb-4">
                    <label for="student-id" class="block text-sm font-medium text-gray-700">รหัสนักศึกษา:</label>
                    <input type="text" id="student-id" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="กรุณากรอกรหัสนักศึกษา">
                </div>
                <div class="mb-6">
                    <label for="user-email" class="block text-sm font-medium text-gray-700">อีเมล (สำหรับอ้างอิง):</label>
                    <input type="email" id="user-email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="ตัวอย่าง: s123456@myuniversity.ac.th">
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="px-6 py-3 bg-indigo-500 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-600 transition duration-300">
                        เริ่มทำแบบทดสอบ &rarr;
                    </button>
                </div>
            </form>
        </div>

        <!-- 2. ส่วนแบบทดสอบหลัก (ซ่อนไว้ก่อน) -->
        <div id="quiz-screen" class="hidden bg-white shadow-xl rounded-xl p-6 sm:p-8 transition-all duration-500">
            <p class="text-sm font-medium text-indigo-600 mb-4">
                คำถามที่ <span id="current-q-number">1</span> / 20
            </p>
            
            <h3 id="question-text" class="text-xl sm:text-2xl font-semibold text-gray-800 mb-6 min-h-[5rem]"></h3>

            <!-- ส่วนแสดงตัวเลือก -->
            <div id="options-container" class="space-y-4">
                <!-- ตัวเลือกจะถูกแทรกที่นี่ด้วย JavaScript -->
            </div>

            <!-- ส่วนการนำทาง -->
            <div class="flex justify-between mt-8 pt-4 border-t border-gray-200">
                <button id="prev-btn" onclick="prevQuestion()" disabled class="px-4 py-2 bg-gray-300 text-gray-700 font-medium rounded-lg shadow hover:bg-gray-400 transition duration-300 disabled:opacity-50">
                    &larr; ก่อนหน้า
                </button>
                <button id="next-btn" onclick="nextQuestion()" class="px-6 py-3 bg-indigo-500 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-600 transition duration-300">
                    ถัดไป &rarr;
                </button>
                <button id="submit-btn" onclick="submitQuiz()" class="hidden px-6 py-3 bg-green-500 text-white font-semibold rounded-lg shadow-lg hover:bg-green-600 transition duration-300">
                    ส่งคำตอบและดูคะแนน
                </button>
            </div>
        </div>
        
        <!-- 3. ส่วนแสดงผลคะแนนและผลลัพธ์ (ซ่อนไว้จนกว่าจะจบ) -->
        <div id="result-screen" class="hidden bg-white shadow-xl rounded-xl p-8 text-center transition-all duration-500 transform scale-95 opacity-0">
            <h2 class="text-4xl font-extrabold text-indigo-600 mb-4">ผลลัพธ์ของแบบทดสอบ</h2>
            <p class="text-2xl text-gray-700">คุณทำได้ถูกต้อง: <span id="score-display" class="font-bold text-green-600"></span> ข้อ</p>
            <p id="feedback-message" class="text-xl mt-4"></p>
            
            <!-- สรุปข้อมูลผู้เข้าสอบ -->
            <div id="user-info-summary" class="bg-indigo-50 p-4 rounded-lg my-6 border border-indigo-200 text-left mx-auto max-w-md">
                <p class="text-lg font-bold text-indigo-800 mb-2">ข้อมูลผู้เข้าสอบ:</p>
                <p id="summary-name" class="text-gray-700 text-base">ชื่อ: -</p>
                <p id="summary-id" class="text-gray-700 text-base">รหัส: -</p>
                <p id="summary-email" class="text-gray-700 text-base">อีเมล: -</p>
            </div>
            
            <!-- ปุ่มส่งผลลัพธ์ผ่าน Mailto -->
            <button id="send-email-btn" onclick="sendResultsByMailto()" class="mt-4 mx-2 px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-300">
                ส่งผลลัพธ์ผ่านอีเมล &nbsp; &#x2709;
            </button>
            
            <!-- ปุ่มคัดลอกผลลัพธ์ (สำรอง) -->
            <button id="copy-btn" onclick="copyResultsToClipboard()" class="mt-4 mx-2 px-6 py-3 bg-teal-500 text-white font-semibold rounded-lg shadow-md hover:bg-teal-600 transition duration-300">
                คัดลอกข้อความผลลัพธ์ &nbsp; &#x2398;
            </button>
            
            <!-- <button onclick="restartQuiz()" class="mt-4 mx-2 px-6 py-3 bg-indigo-500 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-600 transition duration-300">
                เริ่มทำแบบทดสอบใหม่
            </button> -->
            <p class="text-sm text-gray-500 mt-3">**โปรดทราบ: หลังจากคลิกปุ่ม 'ส่งผลลัพธ์ผ่านอีเมล' ท่านต้องกดปุ่ม 'ส่ง' ในโปรแกรมอีเมลของท่านอีกครั้ง**</p>
            <div id="copy-message" class="text-sm text-green-600 mt-3 h-4"></div>
        </div>

    </div>

    <script>
        // ข้อมูลแบบทดสอบ 20 ข้อ (ในภาษาไทย)
        const quizData = [
            {
                question: 'ตัวดำเนินการใดใน Python ที่ใช้สำหรับหารเอาเฉพาะส่วนจำนวนเต็ม (Integer Division)?',
                options: [
                    { text: '/', isCorrect: false, rationale: 'ตัวดำเนินการ / ใช้สำหรับการหารแบบทศนิยม (float division).' },
                    { text: '%', isCorrect: false, rationale: 'ตัวดำเนินการ % ใช้สำหรับการหาเศษจากการหาร (modulo).' },
                    { text: '**', isCorrect: false, rationale: 'ตัวดำเนินการ ** ใช้สำหรับการยกกำลัง (exponentiation).' },
                    { text: '//', isCorrect: true, rationale: 'ตัวดำเนินการ // (floor division) ใช้สำหรับการหารที่ให้ผลลัพธ์เป็นจำนวนเต็มและปัดลงเสมอ' }
                ]
            },
            {
                question: 'ในการเขียนฟังก์ชันใน Python ต้องใช้คีย์เวิร์ดใดในการเริ่มต้น?',
                options: [
                    { text: 'function', isCorrect: false, rationale: 'Python ไม่ได้ใช้คีย์เวิร์ด function แต่ใช้ def แทน' },
                    { text: 'define', isCorrect: false, rationale: 'คีย์เวิร์ด define ไม่ได้ใช้ในการสร้างฟังก์ชันใน Python' },
                    { text: 'def', isCorrect: true, rationale: 'คีย์เวิร์ด def ย่อมาจาก define ใช้ในการกำหนดฟังก์ชันใน Python' },
                    { text: 'func', isCorrect: false, rationale: 'คีย์เวิร์ด func ไม่ได้ใช้ แต่ def ถูกใช้แทน' }
                ]
            },
            {
                question: 'ข้อมูลชนิดใดใน Python ที่ไม่สามารถเปลี่ยนแปลงค่าได้ (immutable)?',
                options: [
                    { text: 'List', isCorrect: false, rationale: 'List เป็นข้อมูลชนิดที่เปลี่ยนแปลงค่าได้ (mutable)' },
                    { text: 'Tuple', isCorrect: true, rationale: 'Tuple เป็นข้อมูลชนิดที่ไม่สามารถเปลี่ยนแปลงค่าได้หลังจากการสร้าง' },
                    { text: 'Dictionary', isCorrect: false, rationale: 'Dictionary เป็นข้อมูลชนิดที่เปลี่ยนแปลงค่าได้ (mutable)' },
                    { text: 'Set', isCorrect: false, rationale: 'Set เป็นข้อมูลชนิดที่เปลี่ยนแปลงค่าได้ (mutable)' }
                ]
            },
            {
                question: 'ผลลัพธ์ของนิพจน์ `3 * 2 ** 2` คืออะไร?',
                options: [
                    { text: '36', isCorrect: false, rationale: 'ถ้าเรียงลำดับผิดเป็น $3 \\times 2 = 6$ และ $6^2 = 36$' },
                    { text: '12', isCorrect: true, rationale: 'ตามลำดับความสำคัญ ตัวดำเนินการยกกำลัง (**) ทำก่อนคูณ (*) ดังนั้น $2^2 = 4$ และ $3 \\times 4 = 12$' },
                    { text: '8', isCorrect: false, rationale: 'ถ้าตีความเป็น $3 \\times 2$ ก่อนจะได้ 6 และ $6^2$ ซึ่งผิด' },
                    { text: '6', isCorrect: false, rationale: 'ถ้าตีความเป็น $3 \\times 2 = 6$ และ $6 \\times 2 = 12$' }
                ]
            },
            {
                question: 'ในการแสดงผลข้อความออกทางหน้าจอใน Python ใช้ฟังก์ชันใด?',
                options: [
                    { text: 'output()', isCorrect: false, rationale: 'ฟังก์ชัน output() ไม่ได้มีอยู่ในการใช้งาน Python พื้นฐาน' },
                    { text: 'write()', isCorrect: false, rationale: 'write() มักใช้สำหรับการเขียนไฟล์ แต่ไม่ใช่สำหรับหน้าจอโดยตรง' },
                    { text: 'print()', isCorrect: true, rationale: 'ฟังก์ชัน print() ใช้สำหรับการแสดงค่าหรือข้อความออกทาง Standard Output (หน้าจอ)' },
                    { text: 'display()', isCorrect: false, rationale: 'ฟังก์ชัน display() ไม่ได้มีอยู่ใน Python พื้นฐาน' }
                ]
            },
            {
                question: 'คีย์เวิร์ดใดที่ใช้ในการวนซ้ำ (iteration) ใน Python และเหมาะสำหรับวนซ้ำบนลำดับ (sequence) ที่มีจำนวนรอบที่แน่นอน?',
                options: [
                    { text: 'do-while', isCorrect: false, rationale: 'Python ไม่มีโครงสร้าง do-while โดยตรง' },
                    { text: 'while', isCorrect: false, rationale: 'while เหมาะสำหรับจำนวนรอบที่ไม่แน่นอนหรือขึ้นอยู่กับเงื่อนไข' },
                    { text: 'loop', isCorrect: false, rationale: 'loop ไม่ใช่คีย์เวิร์ดที่ใช้ในการวนซ้ำใน Python' },
                    { text: 'for', isCorrect: true, rationale: 'คีย์เวิร์ด for เหมาะสำหรับวนซ้ำบนลำดับ เช่น list, tuple, range' }
                ]
            },
            {
                question: 'การเข้าถึงสมาชิกตัวแรกของ list ชื่อ `my_list` ต้องใช้ดัชนี (index) ใด?',
                options: [
                    { text: 'my_list[1]', isCorrect: false, rationale: 'ดัชนี 1 คือสมาชิกตัวที่สอง' },
                    { text: 'my_list[0]', isCorrect: true, rationale: 'ใน Python (และภาษาโปรแกรมส่วนใหญ่) ดัชนีเริ่มต้นที่ 0' },
                    { text: 'my_list[#1]', isCorrect: false, rationale: 'นี่ไม่ใช่รูปแบบการเข้าถึงสมาชิกที่ถูกต้อง' },
                    { text: 'my_list[-1]', isCorrect: false, rationale: 'ดัชนี -1 คือสมาชิกตัวสุดท้าย' }
                ]
            },
            {
                question: 'ในการเขียนเงื่อนไขแบบหลายทางเลือก นอกเหนือจาก `if` และ `else` คีย์เวิร์ดใดที่ใช้สำหรับเงื่อนไขกลาง?',
                options: [
                    { text: 'otherwise', isCorrect: false, rationale: 'คีย์เวิร์ด otherwise ไม่ได้ถูกใช้ใน Python' },
                    { text: 'else if', isCorrect: false, rationale: 'Python ใช้รูปแบบที่สั้นกว่าคือ elif' },
                    { text: 'elseif', isCorrect: false, rationale: 'ต้องเว้นวรรคและใช้ elif' },
                    { text: 'elif', isCorrect: true, rationale: 'elif ย่อมาจาก else if ใช้สำหรับตรวจสอบเงื่อนไขเพิ่มเติม' }
                ]
            },
            {
                question: 'คำสั่งใดที่ใช้ในการหยุดการทำงานของลูป (Loop) ทันที?',
                options: [
                    { text: 'skip', isCorrect: false, rationale: 'skip ไม่ใช่คีย์เวิร์ดที่ถูกต้อง' },
                    { text: 'continue', isCorrect: false, rationale: 'continue ใช้เพื่อข้ามรอบปัจจุบันของลูปไปยังรอบถัดไป' },
                    { text: 'break', isCorrect: true, rationale: 'break ใช้เพื่อออกจากลูปปัจจุบันทันที' },
                    { text: 'exit', isCorrect: false, rationale: 'exit ใช้เพื่อจบการทำงานของโปรแกรมทั้งหมด (มักใช้ในโมดูล sys)' }
                ]
            },
            {
                question: 'ผลลัพธ์ของ `print(type("Hello"))` คืออะไร?',
                options: [
                    { text: '<class \'int\'>', isCorrect: false, rationale: 'Hello เป็นข้อความ ไม่ใช่จำนวนเต็ม' },
                    { text: '<class \'float\'>', isCorrect: false, rationale: 'Hello เป็นข้อความ ไม่ใช่จำนวนทศนิยม' },
                    { text: '<class \'str\'>', isCorrect: true, rationale: 'Hello เป็นข้อมูลชนิดข้อความ (string) ใน Python' },
                    { text: '<class \'list\'>', isCorrect: false, rationale: 'Hello เป็นข้อความ ไม่ใช่รายการ (list)' }
                ]
            },
            {
                question: 'ในการสร้าง Dictionary ว่างเปล่า ต้องใช้สัญลักษณ์ใด?',
                options: [
                    { text: '[]', isCorrect: false, rationale: '[] ใช้สำหรับสร้าง List ว่างเปล่า' },
                    { text: '()', isCorrect: false, rationale: '() ใช้สำหรับสร้าง Tuple ว่างเปล่า' },
                    { text: '{}', isCorrect: true, rationale: '{} ใช้สำหรับสร้าง Dictionary ว่างเปล่า' },
                    { text: '<>', isCorrect: false, rationale: '<> ไม่ได้ใช้ในการสร้าง Dictionary' }
                ]
            },
            {
                question: 'เมื่อรันโค้ด `s = "Python"; print(s[1:4])` ผลลัพธ์ที่ได้คืออะไร?',
                options: [
                    { text: 'ytho', isCorrect: false, rationale: 'ดัชนีเริ่มต้น 1 คือ y, ดัชนีสิ้นสุด 4 (ไม่รวม) คือ o ดังนั้นได้ yth' },
                    { text: 'yth', isCorrect: true, rationale: 'Slicing [1:4] คือดัชนี 1 (y) ถึง 3 (h) โดยไม่รวม 4' },
                    { text: 'Pyt', isCorrect: false, rationale: 'ดัชนี 1 คือ y, ไม่ใช่ P' },
                    { text: 'thon', isCorrect: false, rationale: 'จะพิมพ์ thon ถ้าใช้ s[2:6]' }
                ]
            },
            {
                question: 'ข้อใดคือวิธีที่ถูกต้องในการใส่ความคิดเห็น (Comment) แบบบรรทัดเดียวใน Python?',
                options: [
                    { text: '// นี่คือความคิดเห็น', isCorrect: false, rationale: '// ใช้ในภาษา C++, Java แต่ไม่ใช่ Python' },
                    { text: '-- นี่คือความคิดเห็น', isCorrect: false, rationale: '-- ไม่ได้ใช้เป็น Comment ใน Python' },
                    { text: '# นี่คือความคิดเห็น', isCorrect: true, rationale: 'สัญลักษณ์ # ใช้ในการระบุความคิดเห็นแบบบรรทัดเดียวใน Python' },
                    { text: '/* นี่คือความคิดเห็น */', isCorrect: false, rationale: '/* ... */ ใช้สำหรับ Comment แบบหลายบรรทัดในภาษาอื่น' }
                ]
            },
            {
                question: 'เมื่อรันโค้ด `x = 10; y = 5; print(x > 5 and y < 10)` ผลลัพธ์คืออะไร?',
                options: [
                    { text: 'False', isCorrect: false, rationale: 'ทั้งสองเงื่อนไขเป็น True: $10 > 5$ คือ True, $5 < 10$ คือ True, True and True คือ True' },
                    { text: '1', isCorrect: false, rationale: 'ผลลัพธ์ของ Boolean จะเป็น True หรือ False' },
                    { text: 'True', isCorrect: true, rationale: 'เงื่อนไข $10 > 5$ เป็นจริง และเงื่อนไข $5 < 10$ เป็นจริง ดังนั้น True and True ได้ True' },
                    { text: 'None', isCorrect: false, rationale: 'None ใช้สำหรับค่าว่าง ไม่ใช่ผลลัพธ์ของ Boolean' }
                ]
            },
            {
                question: 'ข้อใดคือชื่อตัวแปรที่ "ไม่ถูกต้อง" ตามกฎการตั้งชื่อใน Python?',
                options: [
                    { text: 'my_variable', isCorrect: false, rationale: 'ถูกต้อง เพราะใช้ตัวอักษรและเครื่องหมาย underscore' },
                    { text: 'variable101', isCorrect: false, rationale: 'ถูกต้อง เพราะมีตัวอักษรและตัวเลข' },
                    { text: '1st_variable', isCorrect: true, rationale: 'ไม่ถูกต้อง เพราะชื่อตัวแปรใน Python ไม่สามารถเริ่มต้นด้วยตัวเลขได้' },
                    { text: '_private_var', isCorrect: false, rationale: 'ถูกต้อง เพราะสามารถเริ่มต้นด้วย underscore ได้' }
                ]
            },
            {
                question: 'ฟังก์ชัน `range(5)` จะสร้างลำดับของตัวเลขใดบ้าง?',
                options: [
                    { text: '1, 2, 3, 4, 5', isCorrect: false, rationale: 'range(n) จะเริ่มจาก 0 และสิ้นสุดที่ $n-1$' },
                    { text: '0, 1, 2, 3, 4', isCorrect: true, rationale: 'range(5) คือ $0, 1, 2, 3, 4$ (ไม่รวม 5)' },
                    { text: '0, 1, 2, 3, 4, 5', isCorrect: false, rationale: 'range(n) จะไม่รวมค่า n' },
                    { text: '5', isCorrect: false, rationale: 'range(5) คือลำดับของตัวเลขหลายตัว' }
                ]
            },
            {
                question: 'ข้อใดคือวัตถุประสงค์หลักของการใช้โมดูล (Module) ใน Python?',
                options: [
                    { text: 'ทำให้โปรแกรมช้าลงเพื่อการดีบัก', isCorrect: false, rationale: 'โมดูลถูกสร้างมาเพื่อจัดระเบียบและเพิ่มประสิทธิภาพการทำงาน' },
                    { text: 'ทำให้โค้ดสั้นลงเพียงบรรทัดเดียว', isCorrect: false, rationale: 'ความยาวโค้ดไม่ใช่จุดประสงค์หลัก' },
                    { text: 'จัดระเบียบโค้ดและนำโค้ดกลับมาใช้ใหม่ได้', isCorrect: true, rationale: 'โมดูลช่วยแบ่งโค้ดออกเป็นไฟล์ที่มีการจัดการที่ดีและสามารถนำฟังก์ชันต่างๆ กลับมาใช้ใหม่ได้' },
                    { text: 'ซ่อนตัวแปรและฟังก์ชันทั้งหมดจากผู้ใช้', isCorrect: false, rationale: 'โมดูลถูกออกแบบมาเพื่อแบ่งปันการใช้งาน' }
                ]
            },
            {
                question: 'ถ้าต้องการรับข้อมูลจากผู้ใช้ผ่านทางคีย์บอร์ดใน Python ต้องใช้ฟังก์ชันใด?',
                options: [
                    { text: 'get_input()', isCorrect: false, rationale: 'ฟังก์ชันนี้ไม่ได้มีอยู่ใน Python พื้นฐาน' },
                    { text: 'read()', isCorrect: false, rationale: 'read() มักใช้สำหรับอ่านไฟล์' },
                    { text: 'input()', isCorrect: true, rationale: 'ฟังก์ชัน input() ใช้เพื่อรับข้อมูลจากผู้ใช้' },
                    { text: 'scanner()', isCorrect: false, rationale: 'scanner() มักใช้ในภาษา Java' }
                ]
            },
            {
                question: 'ชนิดข้อมูลที่จัดเก็บค่าแบบ True หรือ False ใน Python เรียกว่าอะไร?',
                options: [
                    { text: 'String', isCorrect: false, rationale: 'String คือข้อความ' },
                    { text: 'Integer', isCorrect: false, rationale: 'Integer คือจำนวนเต็ม' },
                    { text: 'Boolean', isCorrect: true, rationale: 'Boolean (bool) คือชนิดข้อมูลที่เก็บได้เพียง True หรือ False' },
                    { text: 'Float', isCorrect: false, rationale: 'Float คือจำนวนทศนิยม' }
                ]
            },
            {
                question: 'เมื่อรันโค้ด `my_list = [1, 2, 3]; my_list.append(4); print(my_list)` ผลลัพธ์ที่ได้คืออะไร?',
                options: [
                    { text: '[1, 2, 3]', isCorrect: false, rationale: 'เมธอด append(4) จะเพิ่ม 4 เข้าไปใน list' },
                    { text: '[4, 1, 2, 3]', isCorrect: false, rationale: 'append() จะเพิ่มสมาชิกที่ท้าย list' },
                    { text: '[1, 2, 3, 4]', isCorrect: true, rationale: 'เมธอด append() จะเพิ่มสมาชิกที่ระบุไปยังส่วนท้ายของ list' },
                    { text: 'Error', isCorrect: false, rationale: 'นี่คือการทำงานที่ถูกต้องของเมธอด list.append()' }
                ]
            }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let userName = '';
        let studentId = '';
        let userEmail = '';
        const targetEmail = 'wanchatpookhuntod@gmail.com';

        // Elements
        const formScreen = document.getElementById('form-screen');
        const questionTextElement = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const currentQNumberElement = document.getElementById('current-q-number');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const scoreDisplay = document.getElementById('score-display');
        const feedbackMessage = document.getElementById('feedback-message');
        const copyMessage = document.getElementById('copy-message');

        // ฟังก์ชันเริ่มต้น (รับข้อมูลผู้เข้าสอบ)
        function startQuiz(event) {
            event.preventDefault(); 
            
            // ดึงข้อมูลจากฟอร์ม
            userName = document.getElementById('user-name').value.trim();
            studentId = document.getElementById('student-id').value.trim();
            userEmail = document.getElementById('user-email').value.trim();

            if (userName && studentId && userEmail) {
                // สลับไปหน้าจอแบบทดสอบ
                formScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');
                loadQuestion();
            } else {
                // อันนี้ไม่ควรเกิดขึ้นถ้าใส่ required ใน HTML
                alert('กรุณากรอกข้อมูลผู้เข้าสอบให้ครบถ้วน'); 
            }
        }

        // ฟังก์ชันโหลดคำถาม
        function loadQuestion() {
            const q = quizData[currentQuestionIndex];
            currentQNumberElement.textContent = currentQuestionIndex + 1;
            questionTextElement.textContent = q.question;
            optionsContainer.innerHTML = ''; 

            // สร้างปุ่มตัวเลือก
            q.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.className = 'w-full text-left p-4 rounded-lg border-2 border-gray-200 bg-white hover:bg-indigo-50 hover:border-indigo-400 transition duration-200 text-gray-700 font-medium shadow-sm';
                button.setAttribute('data-index', index);
                button.onclick = () => selectAnswer(index);

                // แสดงสถานะที่เลือก
                if (userAnswers[currentQuestionIndex] === index) {
                    button.classList.add('bg-indigo-100', 'border-indigo-500', 'ring-2', 'ring-indigo-500');
                }

                optionsContainer.appendChild(button);
            });

            // อัพเดตปุ่มนำทาง
            updateNavigationButtons();
            copyMessage.textContent = ''; 
        }

        // ฟังก์ชันเลือกคำตอบ
        function selectAnswer(selectedIndex) {
            userAnswers[currentQuestionIndex] = selectedIndex;
            
            // อัพเดตปุ่มตัวเลือกเพื่อแสดงการเลือก
            optionsContainer.querySelectorAll('button').forEach((button, index) => {
                button.classList.remove('bg-indigo-100', 'border-indigo-500', 'ring-2', 'ring-indigo-500');
                if (index === selectedIndex) {
                    button.classList.add('bg-indigo-100', 'border-indigo-500', 'ring-2', 'ring-indigo-500');
                }
            });

            // ตรวจสอบว่าพร้อมจะแสดงปุ่มส่งคำตอบหรือไม่
            if (currentQuestionIndex === quizData.length - 1) {
                submitBtn.classList.remove('hidden');
            }
        }

        // ฟังก์ชันอัพเดตปุ่มนำทาง
        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex < quizData.length - 1) {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            } else {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            }
        }

        // ฟังก์ชันไปคำถามถัดไป
        function nextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        // ฟังก์ชันกลับไปคำถามก่อนหน้า
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        // ฟังก์ชันส่งคำตอบและแสดงคะแนน
        function submitQuiz() {
            let score = 0;
            
            // คำนวณคะแนน
            for (let i = 0; i < quizData.length; i++) {
                const selectedIndex = userAnswers[i];
                if (selectedIndex !== null && quizData[i].options[selectedIndex].isCorrect) {
                    score++;
                }
            }

            // แสดงผลลัพธ์
            scoreDisplay.textContent = `${score} / ${quizData.length}`;
            
            let feedback = '';
            const percentage = (score / quizData.length) * 100;
            if (percentage === 100) {
                feedback = 'ยอดเยี่ยม! คุณทำได้สมบูรณ์แบบ แสดงว่าพื้นฐาน Python ของคุณแข็งแกร่งมาก';
            } else if (percentage >= 70) {
                feedback = 'ทำได้ดีมาก! ความเข้าใจใน Python ของคุณอยู่ในระดับที่ดี ลองทบทวนข้อที่พลาดเล็กน้อยเพื่อความสมบูรณ์แบบ';
            } else if (percentage >= 40) {
                feedback = 'ทำได้ดีแล้ว! คุณมีพื้นฐานบางส่วนแล้ว แต่ควรใช้เวลาทบทวนแนวคิดหลักๆ อีกครั้ง';
            } else {
                feedback = 'เป็นกำลังใจให้ครับ! นี่เป็นจุดเริ่มต้นที่ดีในการเรียนรู้ Python ลองทบทวนข้อมูลพื้นฐานและลองทำอีกครั้ง';
            }
            feedbackMessage.textContent = feedback;
            
            // แสดงข้อมูลผู้เข้าสอบในหน้าสรุป
            document.getElementById('summary-name').textContent = `ชื่อ: ${userName}`;
            document.getElementById('summary-id').textContent = `รหัส: ${studentId}`;
            document.getElementById('summary-email').textContent = `อีเมล: ${userEmail}`;


            // ซ่อนหน้าจอแบบทดสอบและแสดงหน้าจอผลลัพธ์
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            // เพิ่ม animation effect ให้ผลลัพธ์
            setTimeout(() => {
                resultScreen.classList.remove('scale-95', 'opacity-0');
            }, 50);
        }

        // ฟังก์ชันเริ่มทำแบบทดสอบใหม่
        function restartQuiz() {
            currentQuestionIndex = 0;
            userAnswers = new Array(quizData.length).fill(null);
            
            // ล้างข้อมูลผู้เข้าสอบ
            userName = '';
            studentId = '';
            userEmail = '';
            document.getElementById('user-info-form').reset();
            
            // สลับหน้าจอ
            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            formScreen.classList.remove('hidden');
            
            // โหลดคำถามแรก
            loadQuestion();
            // ซ่อนปุ่ม submit อีกครั้ง
            submitBtn.classList.add('hidden');
        }

        // ฟังก์ชันส่งผลลัพธ์ผ่าน Mailto (ตามคำขอ)
        function sendResultsByMailto() {
            const scoreText = scoreDisplay.textContent;
            const feedbackText = feedbackMessage.textContent;
            
            // สร้างหัวข้ออีเมล
            const subject = encodeURIComponent(`ผลสอบ Python พื้นฐาน: ${userName} (${studentId}) - คะแนน ${scoreText}`);
            
            // สร้างเนื้อหาอีเมล
            const body = encodeURIComponent(
                `เรียน ผู้ตรวจ,\n\n` +
                `ผลลัพธ์แบบทดสอบ Python พื้นฐานมีดังนี้:\n\n` +
                `1. ชื่อ-นามสกุล: ${userName}\n` +
                `2. รหัสนักศึกษา: ${studentId}\n` +
                `3. อีเมลผู้เข้าสอบ: ${userEmail}\n\n` +
                `4. คะแนนที่ทำได้: ${scoreText} ข้อ จาก 20 ข้อ\n` +
                `5. ข้อเสนอแนะจากระบบ: ${feedbackText}\n\n` +
                `ขอบคุณครับ/ค่ะ`
            );

            // สร้าง Mailto Link และเปิดโปรแกรมอีเมล
            const mailtoLink = `mailto:${targetEmail}?subject=${subject}&body=${body}`;
            window.location.href = mailtoLink;
        }

        // ฟังก์ชันคัดลอกผลลัพธ์ไปที่คลิปบอร์ด (สำรอง)
        function copyResultsToClipboard() {
            const scoreText = scoreDisplay.textContent;
            const feedbackText = feedbackMessage.textContent;
            
            const fullResult = 
                `ผลลัพธ์แบบทดสอบ Python พื้นฐาน:\n` +
                `ชื่อ-นามสกุล: ${userName}\n` +
                `รหัสนักศึกษา: ${studentId}\n` +
                `อีเมลผู้เข้าสอบ: ${userEmail}\n` +
                `คะแนน: คุณทำได้ถูกต้อง ${scoreText} ข้อ\n` +
                `ข้อเสนอแนะ: ${feedbackText}\n\n` +
                `ส่งโดย: แบบทดสอบออนไลน์`;

            // สร้าง textarea ชั่วคราว
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = fullResult;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            
            let success = false;
            try {
                success = document.execCommand('copy');
            } catch (err) {
                console.error('Copy failed:', err);
            }
            
            document.body.removeChild(tempTextArea);

            const copyMessageElement = document.getElementById('copy-message');
            if (success) {
                copyMessageElement.textContent = 'คัดลอกผลลัพธ์ไปที่คลิปบอร์ดแล้ว!';
                copyMessageElement.classList.remove('text-red-500');
                copyMessageElement.classList.add('text-green-600');
            } else {
                copyMessageElement.textContent = 'การคัดลอกล้มเหลว กรุณาไฮไลต์ข้อความและคัดลอกด้วยตนเอง';
                copyMessageElement.classList.remove('text-green-600');
                copyMessageElement.classList.add('text-red-500');
            }
            
            // ล้างข้อความหลังจาก 3 วินาที
            setTimeout(() => {
                copyMessageElement.textContent = '';
            }, 3000);
        }

        // เริ่มต้น: หน้าจอฟอร์มถูกแสดงเป็นหน้าแรก
        window.onload = function() {
            formScreen.classList.remove('hidden');
            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            loadQuestion(); // โหลดคำถามเผื่อไว้
        }
    </script>

</body>
</html>
